<meta name="color-scheme" content="dark">

<style> * {font-family: monospace;}</style>
<h1>CHESS</h1>
<button id="turnButton">Take Turn</button>
<button id="updateBoard">Update Board</button>
<h3 id="info">Welcome to Chess. White is lowercase and black is uppercase. <br></h3>
<h3 id="squareNames"><br></h3>

<script>
//Stores the opening board. Capital letter stands for black and lowercase stands for white. X is an empty square.
var chessBoard = [
    "R1", "N1", "B1", "QU", "KI", "B2", "N2", "R2",
    "P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8",
    "[]", "[]", "[]", "[]", "[]", "[]", "[]", "[]",
    "[]", "[]", "[]", "[]", "[]", "[]", "[]", "[]",
    "[]", "[]", "[]", "[]", "[]", "[]", "[]", "[]",
    "[]", "[]", "[]", "[]", "[]", "[]", "[]", "[]",
    "p1", "p2", "p3", "p4", "p5", "p6", "p7", "p8",
    "r1", "n1", "b1", "qu", "ki", "b2", "n2", "r2"
]; 

//Stores the name of the squares.
var squareNames = [
    "A8", "B8" ,"C8", "D8", "E8", "F8", "G8", "H8",
    "A7", "B7" ,"C7", "D7", "E7", "F7", "G7", "H7",
    "A6", "B6" ,"C6", "D6", "E6", "F6", "G6", "H6",
    "A5", "B5" ,"C5", "D5", "E5", "F5", "G5", "H5",
    "A4", "B4" ,"C4", "D4", "E4", "F4", "G4", "H4",
    "A3", "B3" ,"C3", "D3", "E3", "F3", "G3", "H3",
    "A2", "B2" ,"C2", "D2", "E2", "F2", "G2", "H2",
    "A1", "B1" ,"C1", "D1", "E1", "F1", "G1", "H1"
]; 

//Stores all unmoved pawns, so the program nows wich ones that can move 2 squares.
var unmovedPawns = ["p1", "p2", "p3", "p4", "p5","p6", "p7", "p8", "P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8"];

var whitePieces = ["p1", "p2", "p3", "p4", "p5", "p6", "p7", "p8", "r1", "r2", "b1", "b2", "n1", "n2", "qu", "ki"];
var blackPieces = ["P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8", "R1", "R2", "B1", "B2", "N1", "N2", "QU", "KI"];

//Makes it possible for the program to check if the players wants to make an illegal move.
var legalMoves = [];
var isLegalMove = false;

//Stores the name of the pieces for future use. This will be used to restrict the movement of the pieces.
var pieces = ["Pawn", "Rook", "Knight", "Bishop", "Queen", "King"];

//This button starts the next turn.
var turnButton = document.getElementById("turnButton");
turnButton.addEventListener("click", TurnOrder); 
//This button updates the board.
var updateBoard = document.getElementById("updateBoard");
updateBoard.addEventListener("click", PrintBoard); 

//Variables for the choosen piece and square to move to.
var chosenPiece;
var chosenSquare;
var pieceIndex;
var squareIndex;

var upgradeTo;

//Checks which players turn it is.
var isWhiteTurn = true; 

//This function is what prints the board.
function PrintBoard()
{
    var updateBoard = document.getElementById("squareNames");
    updateBoard.innerHTML = " ";   
    for(var i = 0; i < chessBoard.length; i++)
    { 
        if((i + 1) % 8 == 0)
        {
            var updateBoard = document.getElementById("squareNames");
            updateBoard.innerHTML += chessBoard[i] + " " + "<br>";
        }
        else
        {
            var updateBoard = document.getElementById("squareNames");
            updateBoard.innerHTML += chessBoard[i] + " ";
        }
    }
}

//This function controlls the actual turns.
function TurnOrder()
{
    //Notifies wich players turn it is.
    if(isWhiteTurn)
    {
       alert("White turn."); 
    }
    else
    {
        alert("Black turn");
    }

    //Depending on whhat players turn it is the program goes to different functions.
    if(isWhiteTurn)
    {
        WhiteTurn();
    }
    else
    {
        BlackTurn();
    }

    //A loop that will continue as long as the player atempts an illegal move.
    while(isLegalMove == false)
    {
        //Updates the chosenSquare variable depending on the players answer.
        chosenSquare = prompt("Where do you want to move the piece?");
        chosenSquare = chosenSquare.toUpperCase();

        //If the move is legal the board will update.
        if(legalMoves.includes(chosenSquare))
        {
            //Gets the indexes of the chosen piece and square so we can change those places in the chessBoard array. 
            pieceIndex = chessBoard.indexOf(chosenPiece);
            squareIndex = squareNames.indexOf(chosenSquare);
            chessBoard[pieceIndex] = "[]";
            chessBoard[squareIndex] = chosenPiece;
            isLegalMove = true;
        }
        else
        {
            alert("That is not a legal move!");
        }
    }

    //The UpgradePiece function checks if the piece should be upgraded
    UpgradePiece();

    //Checks if the moved pawn is in the unmovedPawns array and if it is it gets removed
    if(unmovedPawns.includes(chosenPiece))
    {
        //Removes the chosen pawn from the unmovedPawns array.
        unmovedPawns.splice(unmovedPawns.indexOf(chosenPiece), 1);
    }

    //Resets the legalMoves properties.
    isLegalMove = false;   
    legalMoves.splice(0); 

    //Changes what players turn it is
    if(isWhiteTurn)
    {
        isWhiteTurn = false;  
    }
    else
    {
        isWhiteTurn = true;
    }
}

//Controls the white players turn.
//Depending on the players answer the program will go to the right function
function WhiteTurn()
{
    //Updates the chosenPiece variable depending on the players answer.
    chosenPiece = prompt("What piece do you want to move?");
    chosenPiece = chosenPiece.toLowerCase();
    
    if(chosenPiece.includes("p"))
    {
        PawnMovement();
    }
    else if(chosenPiece.includes("r"))
    {
        RookMovement();
    }
    else if(chosenPiece.includes("n"))
    {
        KnightMovement();
    }
    else if(chosenPiece.includes("b"))
    {
        BishopMovement();
    }
    else if(chosenPiece.includes("k"))
    {
        KingMovement();
    }
    else if(chosenPiece.includes("q"))
    {
        QueenMovement();
    }
    else
    {
        /*var infoText = getElementById("info");
        infotext.innerHTML = "That is not a valid piece!";*/
        alert("That is not a valid piece!");
        WhiteTurn();
    }

    if(legalMoves.length == 0)
    {
        /*var infoText = getElementById("info");
        infotext.innerHTML = "That is not a valid piece!";*/
        alert("You can not move that piece this turn!");
        WhiteTurn();
    }
}

//Controls the black players turn.
//Depending on the players answer the program will go to the right function
function BlackTurn()
{
    //Updates the chosenPiece variable depending on the players answer.
    chosenPiece = prompt("What piece do you want to move?");
    chosenPiece = chosenPiece.toUpperCase();
    
    if(chosenPiece.includes("P"))
    {
        PawnMovement();
    }
    else if(chosenPiece.includes("R"))
    {
        RookMovement();
    }
    else if(chosenPiece.includes("N"))
    {
        KnightMovement();
    }
    else if(chosenPiece.includes("B"))
    {
        BishopMovement();
    }
    else if(chosenPiece.includes("K"))
    {
        KingMovement();
    }
    else if(chosenPiece.includes("Q"))
    {
        QueenMovement();
    }
    else
    {
        /*var infoText = getElementById("info");
        infotext.innerHTML = "That is not a valid piece!";*/
        alert("That is not a valid piece!");
        BlackTurn();
    }

    if(legalMoves.length == 0)
    {
        /*var infoText = getElementById("info");
        infotext.innerHTML = "That is not a valid piece!";*/
        alert("You can not move that piece this turn!");
        BlackTurn();
    }
}

//ADD SO THE PAWN CAN MOVE DIAGONALY IF ADJACENT PAWN MOVED TWO SQUARES
//Controls the pawn movement.
//Depending on wich players turn it is there will be a different equation.
function PawnMovement()
{
    var moves = chessBoard.indexOf(chosenPiece);
    if(isWhiteTurn)
    {
        if(chessBoard[moves-8] == "[]")
        {
            legalMoves.push(squareNames[moves-8]);   
        }
        
        if(unmovedPawns.includes(chosenPiece) && chessBoard[moves-16] == "[]" && chessBoard[moves-8] == "[]")
        {
            legalMoves.push(squareNames[moves - 16]);
        }

        //Checks if there is a black piece UP diagonaly to the RIGHT of the pawn
        if(blackPieces.includes(chessBoard[moves-7]))
        {
            //If the chosen pawn isn't on the H-row, wich all +1 is devisble by 8, the square should be added to the legalMoves array 
            if((moves + 1) % 8 != 0)
            {
                legalMoves.push(squareNames[moves-7]);
            }  
        }
        //Checks if there is a black piece UP diagonaly to the LEFT of the pawn
        if(blackPieces.includes(chessBoard[moves-9]))
        {
            //If the chosen pawn isn't on the A-row, wich all is devisble by 8, the square should be added to the legalMoves array
            if((moves) % 8 != 0)
            {
                legalMoves.push(squareNames[moves-9]);
            } 
        }

        console.log(legalMoves.length);
    }
    else //Black
    {
        if(chessBoard[moves+8] == "[]")
        {
            legalMoves.push(squareNames[moves+8]);
        }

        if(unmovedPawns.includes(chosenPiece) && chessBoard[moves+16] == "[]" && chessBoard[moves+8] == "[]")
        {
            legalMoves.push(squareNames[moves + 16]);
        }

        //Checks if there is a piece DOWN diagonaly to the LEFT of the pawn
        if(whitePieces.includes(chessBoard[moves+7]))
        {
            //If the chosen pawn isn't on the A-row, wich all is devisble by 8, the square should be added to the legalMoves array 
            if((moves) % 8 != 0)
            {
                legalMoves.push(squareNames[moves+7]);
            }  
        }
        //Checks if there is a piece DOWN diagonaly to the RIGHT of the pawn
        if(whitePieces.includes(chessBoard[moves+9]))
        {
            //If the chosen pawn isn't on the A-row, wich all is devisble by 8, the square should be added to the legalMoves array
            if((moves+1) % 8 != 0)
            {
                legalMoves.push(squareNames[moves+9]);
            } 
        }
    }
}

function RookMovement()
{
    var moves = chessBoard.indexOf(chosenPiece);
    if(isWhiteTurn)
    {
        //Checks if the rook can move to the RIGHT
        if((moves + 1) % 8 != 0 && !whitePieces.includes(chessBoard[moves+1]))
        {
            if(blackPieces.includes(chessBoard[moves+1]))
            {
                moves++;
                legalMoves.push(squareNames[moves]);
            }
            else
            {
                moves++;
                legalMoves.push(squareNames[moves]);
                
                while(chessBoard[moves+1] == "[]" || blackPieces.includes(chessBoard[moves+1]))
                {
                    if(blackPieces.includes(chessBoard[moves+1]))
                    {
                        moves++;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves++;
                    legalMoves.push(squareNames[moves]);
                    if((moves + 1) % 8 == 0 || whitePieces.includes(chessBoard[moves+1]) )
                    {
                        break;
                    }
                }
            }
        }
        moves = chessBoard.indexOf(chosenPiece);

        //Checks if the rook can move to the LEFT
        if(((moves) % 8 != 0 || moves != 0) && !whitePieces.includes(chessBoard[moves-1]))
        {
            //If the square to the LEFT contains a WHITE piece only that square is added to legalMoves
            if(blackPieces.includes(chessBoard[moves-1]))
            {
                moves--;
                legalMoves.push(squareNames[moves]); 
            }
            else
            {
                moves--;
                legalMoves.push(squareNames[moves]);
                
                while(chessBoard[moves-1] == "[]" || blackPieces.includes(chessBoard[moves-1]))
                {
                    if(blackPieces.includes(chessBoard[moves-1]))
                    {
                        moves--;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves--;
                    legalMoves.push(squareNames[moves]);
                    if((moves) % 8 == 0 || whitePieces.includes(chessBoard[moves-1]))
                    {
                        break;
                    }
                }
            }
        }
        moves = chessBoard.indexOf(chosenPiece);

        //Checks if the rook can move DOWN. If it is >= 56 it is on the bottom line.
        if((chessBoard.indexOf(chosenPiece) < 56) && !whitePieces.includes(chessBoard[moves+8]))
        {
            if(whitePieces.includes(chessBoard[moves+8]))
            {
                moves+=8;
                legalMoves.push(squareNames[moves]);
            }
            else
            {
                moves+=8;
                legalMoves.push(squareNames[moves]);

                while(chessBoard[moves+8] == "[]" || blackPieces.includes(chessBoard[moves+8]))
                {
                    if(blackPieces.includes(chessBoard[moves+8]))
                    {
                        moves+=8;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves+=8;
                    legalMoves.push(squareNames[moves]);
                    if(moves >= 56 || whitePieces.includes(chessBoard[moves+8]))
                    {
                        break;
                    }
                }
            }
        }
        moves = chessBoard.indexOf(chosenPiece);

        //Checks if the rook can move UP. If it is <= 7 it is on the bottom line.
        if((chessBoard.indexOf(chosenPiece) > 7) && !whitePieces.includes(chessBoard[moves-8]))
        {
            if(blackPieces.includes(chessBoard[moves-8]))
            {
                moves-=8;
                legalMoves.push(squareNames[moves]);
            }
            else
            {
                moves-=8;
                legalMoves.push(squareNames[moves]);

                while(chessBoard[moves-8] == "[]" || blackPieces.includes(chessBoard[moves-8]))
                {
                    if(blackPieces.includes(chessBoard[moves-8]))
                    {
                        moves-=8;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves-=8;
                    legalMoves.push(squareNames[moves]);
                    if(moves <= 7 || whitePieces.includes(chessBoard[chessBoard[moves-8]]))
                    {
                        break;
                    }
                }
            }
        } 
    }
    else //Black turn
    {
        //Checks if the rook can move to the RIGHT
        if((moves + 1) % 8 != 0 && !blackPieces.includes(chessBoard[moves+1]))
        {
            if(whitePieces.includes(chessBoard[moves+1]))
            {
                moves++;
                legalMoves.push(squareNames[moves]);
            }
            else
            {
                moves++;
                legalMoves.push(squareNames[moves]);
                
                while(chessBoard[moves+1] == "[]" || whitePieces.includes(chessBoard[moves+1]))
                {
                    if(whitePieces.includes(chessBoard[moves+1]))
                    {
                        moves++;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves++;
                    legalMoves.push(squareNames[moves]);
                    if((moves + 1) % 8 == 0 || blackPieces.includes(chessBoard[moves+1]) )
                    {
                        break;
                    }
                }
            }
        }
        moves = chessBoard.indexOf(chosenPiece);

        //Checks if the rook can move to the LEFT
        if(((moves) % 8 != 0 || moves != 0) && !blackPieces.includes(chessBoard[moves-1]))
        {
            //If the square to the LEFT contains a WHITE piece only that square is added to legalMoves
            if(whitePieces.includes(chessBoard[moves-1]))
            {
                moves--;
                legalMoves.push(squareNames[moves]); 
            }
            else
            {
                moves--;
                legalMoves.push(squareNames[moves]);
                
                while(chessBoard[moves-1] == "[]" || whitePieces.includes(chessBoard[moves-1]))
                {
                    if(whitePieces.includes(chessBoard[moves-1]))
                    {
                        moves--;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves--;
                    legalMoves.push(squareNames[moves]);
                    if((moves) % 8 == 0 || blackPieces.includes(chessBoard[moves-1]))
                    {
                        break;
                    }
                }
            }
        }
        moves = chessBoard.indexOf(chosenPiece);

        //Checks if the rook can move DOWN. If it is >= 56 it is on the bottom line.
        if((chessBoard.indexOf(chosenPiece) < 56) && !blackPieces.includes(chessBoard[moves+8]))
        {
            if(whitePieces.includes(chessBoard[moves+8]))
            {
                moves+=8;
                legalMoves.push(squareNames[moves]);
            }
            else
            {
                moves+=8;
                legalMoves.push(squareNames[moves]);

                while(chessBoard[moves+8] == "[]" || whitePieces.includes(chessBoard[moves+8]))
                {
                    if(whitePieces.includes(chessBoard[moves+8]))
                    {
                        moves+=8;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves+=8;
                    legalMoves.push(squareNames[moves]);
                    if(moves >= 56 || blackPieces.includes(chessBoard[moves+8]))
                    {
                        break;
                    }
                }
            }
        }
        moves = chessBoard.indexOf(chosenPiece);

        //Checks if the rook can move UP. If it is <= 7 it is on the bottom line.
        if((chessBoard.indexOf(chosenPiece) > 7) && !blackPieces.includes(chessBoard[moves-8]))
        {
            if(whitePieces.includes(chessBoard[moves-8]))
            {
                moves-=8;
                legalMoves.push(squareNames[moves]);
            }
            else
            {
                moves-=8;
                legalMoves.push(squareNames[moves]);

                while(chessBoard[moves-8] == "[]" || whitePieces.includes(chessBoard[moves-8]))
                {
                    if(whitePieces.includes(chessBoard[moves-8]))
                    {
                        moves-=8;
                        legalMoves.push(squareNames[moves]);
                        break;
                    }
                    moves-=8;
                    legalMoves.push(squareNames[moves]);
                    if(moves <= 7 || blackPieces.includes(chessBoard[chessBoard[moves-8]]))
                    {
                        break;
                    }
                }
            }
        } 
    }
}

function KnightMovement()
{
    if(isWhiteTurn)
    {

    }
    else
    {
        
    }
}

function BishopMovement()
{
    if(isWhiteTurn)
    {

    }
    else
    {
        
    }
}

function QueenMovement()
{
    if(isWhiteTurn)
    {

    }
    else
    {
        
    }
}

function KingMovement()
{
    if(isWhiteTurn)
    {

    }
    else
    {
        
    }
}

//CHANGE THIS WHEN IMPLEMENTING POWERUPS
//This function upgrades the pawns into a queen when reaching the end of the board
function UpgradePiece()
{
    //Checks if the chosenPiece includes p or P
    if(chosenPiece.includes("p") || chosenPiece.includes("P"))
    {
        //Checks if the pawn has reached the top row (index <= 7) or the bottom row (index >= 56)
        if(chessBoard.indexOf(chosenPiece) <= 7 || chessBoard.indexOf(chosenPiece) >= 56)
        {
            //Checks if it is a white or a black piece
            if(chosenPiece.includes("p"))
            {
                upgradeTo = prompt("What piece do you want to upgrade the pawn to?");
                upgradeTo = upgradeTo.toLowerCase();
                chessBoard[chessBoard.indexOf(chosenPiece)] = upgradeTo;   
            } 
            else if(chosenPiece.includes("P"))
            {
                upgradeTo = prompt("What piece do you want to upgrade the pawn to?");
                upgradeTo = upgradeTo.toUpperCase();
                chessBoard[chessBoard.indexOf(chosenPiece)] = upgradeTo;
            }
        }
    }
}
</script>